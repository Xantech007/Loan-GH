# .htaccess - Clean URLs, Security & Redirects

<IfModule mod_rewrite.c>
    RewriteEngine On

    # 1. Force HTTPS and non-www (redirect www to non-www)
    RewriteCond %{HTTPS} off [OR]
    RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
    RewriteCond %{HTTP_HOST} ^(?:www\.)?(.+)$ [NC]
    RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301,NE]

    # 2. External redirect: Remove .php if directly requested
    RewriteCond %{THE_REQUEST} \s/+(.+?)\.php[\s?] [NC]
    RewriteRule ^ /%1 [R=301,L,NE]

    # 3. External redirect: Remove .html if directly requested
    RewriteCond %{THE_REQUEST} \s/+(.+?)\.html[\s?] [NC]
    RewriteRule ^ /%1 [R=301,L,NE]

    # 4. Internal rewrite: Add .php if file exists (for extensionless URLs)
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME}.php -f
    RewriteRule ^(.+)$ $1.php [L]

    # 5. Internal rewrite: Add .html if file exists (fallback after .php check)
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME}.html -f
    RewriteRule ^(.+)$ $1.html [L]
</IfModule>

# Prevent directory listing
Options -Indexes

# Optional: Block access to sensitive files (uncomment if needed)
# <Files ~ "\.(htaccess|htpasswd|ini|log|sh|inc|bak)$">
#     Order Allow,Deny
#     Deny from all
# </Files>
